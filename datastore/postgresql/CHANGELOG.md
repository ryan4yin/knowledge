# PostgreSQL 版本发布历史

本文档总结了 PostgreSQL 各版本的发布时间、主要新功能和破坏性变更。

> https://www.postgresql.org/docs/release/

## PostgreSQL 版本发布时间与重点功能

### PostgreSQL 10 (2017年10月)
**发布时间**: 2017年10月

**主要新功能**:
- **声明式分区**: 原生支持表分区功能
- **并行查询**: 支持并行聚合、并行连接
- **逻辑复制**: 支持逻辑复制功能
- **SCRAM-SHA-256**: 更安全的密码认证
- **改进的哈希索引**: 重新设计的哈希索引

**破坏性变更**:
- `v2` 数组下标语法被移除
- 修改了一些系统函数的返回类型

### PostgreSQL 11 (2018年10月)
**发布时间**: 2018年10月

**主要新功能**:
- **并行 CREATE INDEX**: 支持并行创建索引
- **JIT 编译**: 即时编译支持
- **覆盖索引**: INCLUDE 子句支持
- **存储过程**: 支持事务性存储过程
- **分区改进**: 支持哈希分区

**破坏性变更**:
- 默认启用了并行计划

### PostgreSQL 12 (2019年10月)
**发布时间**: 2019年10月

**主要新功能**:
- **JSON 路径查询**: SQL/JSON 路径表达式
- **生成列**: 支持生成列
- **分区裁剪改进**: 更智能的分区裁剪
- **B树索引改进**: 支持索引去重
- **并行 vacuum**: 支持并行清理

**破坏性变更**:
- 移除了 `recovery.conf`，改用 `standby.signal`
- 某些配置参数发生变化

### PostgreSQL 13 (2020年9月)
**发布时间**: 2020年9月

**主要新功能**:
- **并行索引清理**: 支持并行索引清理
- **B树索引去重**: 自动去重重复的索引条目
- **增量排序**: 优化排序性能
- **vacuum 进程管理**: 改进的 vacuum 管理

**破坏性变更**:
- 修改了一些系统函数的参数
- 某些系统视图结构发生变化

### PostgreSQL 14 (2021年9月30日)
**发布时间**: 2021年9月30日

**主要新功能**:
- **存储过程 OUT 参数**: 存储过程支持 OUT 参数返回数据
- **多范围数据类型**: 新增多范围类型支持非连续数据范围
- **SQL 标准 CTE 扩展**: `SEARCH` 和 `CYCLE` 选项支持递归查询
- **jsonb/hstore 下标访问**: 扩展下标操作支持 jsonb 和 hstore 数据类型
- **查询管道化**: libpq 支持查询管道化，提升高延迟连接吞吐量
- **B树索引优化**: 减少索引膨胀，提升更新效率
- **表达式统计信息**: 支持在表达式上收集扩展统计信息

**重要改进**:
- **VACUUM 自动化**: 接近事务ID回绕时自动更积极清理
- **SSL SNI 支持**: SSL 连接包支持服务器名称指示
- **LZ4 压缩**: TOAST 数据支持 LZ4 压缩
- **安全增强**: 大量认证和安全改进

**破坏性变更**:
- **默认密码加密**: 从 md5 改为 scram-sha-256
- **SSL 压缩移除**: 移除 SSL 压缩支持
- **权限系统变更**: 需要迁移注意的向后不兼容变更

### PostgreSQL 15 (2022年10月13日)
**发布时间**: 2022年10月13日

**主要新功能**:
- **SQL MERGE 命令**: 支持标准 SQL MERGE 语句
- **逻辑复制选择性发布**: 支持选择发布表的特定内容
- **Zstandard 压缩**: 新增 Zstd 压缩选项
- **JSON 格式日志**: 支持结构化 JSON 格式服务器日志
- **排序性能优化**: 内存和磁盘排序性能显著提升
- **分区表查询优化**: 改进分区表查询规划时间

**重要改进**:
- **GiST 索引性能**: 提升索引查找性能
- **窗口函数优化**: 改进窗口函数执行性能
- **WAL 压缩**: 全页写入支持 LZ4 和 Zstd 压缩
- **安全权限**: 新的默认模式权限模式

**破坏性变更**:
- **public 模式权限**: 移除 PUBLIC 在 public 模式的创建权限
- **模式所有者变更**: public 模式所有者改为 pg_database_owner 角色
- **排他备份模式**: 移除长期弃用的排他备份模式
- **Python 语言移除**: 移除 plpython2u 和 plpythonu 服务端语言

### PostgreSQL 16 (2023年9月14日)
**发布时间**: 2023年9月14日

**主要新功能**:
- **并行查询增强**: 支持并行 FULL 和右外哈希连接
- **从备库逻辑复制**: 支持从物理备库进行逻辑复制
- **并行事务复制**: 逻辑复制支持并行应用大事务
- **SQL/JSON 构造函数**: 新增 JSON 标准构造函数和标识函数
- **I/O 统计监控**: 新增 pg_stat_io 视图监控 I/O 统计

**重要改进**:
- **VACUUM 冻结性能**: 改进带有页面冻结的 VACUUM 操作性能
- **ICU 排序规则**: 支持自定义规则的 ICU 排序规则
- **正则表达式认证**: pg_hba.conf 支持用户和数据库名正则匹配
- **Windows 支持**: 改进 Windows 平台支持
- **构建系统**: 新增 Meson 构建系统支持

**破坏性变更**:
- **废弃变量移除**: 移除多个废弃的服务器变量
- **权限系统增强**: 角色管理权限系统增强
- **归档处理**: 改进归档处理和压缩选项
- **索引行为**: NULLS NOT DISTINCT 索引行为变更

### PostgreSQL 17 (2024年9月26日)
**发布时间**: 2024年9月26日

**主要新功能**:
- **全新内存管理系统**: VACUUM 内存消耗大幅**降低至原来的 1/20**，显著提升清理性能
- **完整 SQL/JSON 支持**:
  - `JSON_TABLE()` 函数将 JSON 数据转换为标准的 PostgreSQL 表
  - SQL/JSON 构造函数: `JSON()`, `JSON_SCALAR()`, `JSON_SERIALIZE()`
  - 查询函数: `JSON_EXISTS()`, `JSON_QUERY()`, `JSON_VALUE()`
- **逻辑复制革命性改进**:
  - `pg_createsubscriber` 工具支持从物理备库创建逻辑复制
  - 逻辑复制槽故障转移控制
  - `pg_upgrade` 保留逻辑复制槽
  - 订阅端支持哈希索引
- **增量备份支持**:
  - `pg_basebackup` 支持增量备份
  - `pg_combinebackup` 工具操作基础和增量备份
  - WAL 汇总文件支持增量备份
- **客户端增强**:
  - `sslnegotiation=direct` 选项支持直接 TLS 握手
  - `COPY` 新增 `ON_ERROR ignore` 选项遇错继续
  - `COPY FROM` 报告跳过行并支持强制 null/not null 列

**重要改进**:
- **流式 I/O**: 改进顺序读取性能
- **高并发写入**: 提升高并发场景下的写入吞吐量（**可能有高达两倍的提升**）
- **MERGE 增强**: 支持 `WHEN NOT MATCHED BY SOURCE` 和 `RETURNING` 子句
- **事务超时**: 新增 `transaction_timeout` 配置
- **内置平台无关排序规则提供程序**
- **新增系统视图**: `pg_stat_checkpointer`
- **分区表排除约束**: 支持分区表的排除约束
- **并行 BRIN 索引创建**
- **VACUUM 进度报告**: 支持索引处理进度报告

**破坏性变更**:
- 移除了多个过时的配置参数和功能
- 增强了权限管理系统
- 修改了某些默认行为以提升安全性

### PostgreSQL 18 (2025年9月)
**发布时间**: 2025年9月25日

**主要新功能**:
- **异步 I/O 子系统**: 全新的异步 I/O 架构，显著提升 I/O 性能
- **B树索引跳过扫描**: B-tree 索引支持 skip scan 查询优化
- **uuidv7() 函数**: 支持时间排序的 UUID 生成
- **虚拟生成列**: 支持虚拟生成列功能
- **OAuth 认证**: 原生 OAuth 认证支持
- **改进的并行查询**: 进一步优化并行查询性能

**破坏性变更**:
- **initdb 默认启用数据校验和**: 提升数据完整性保护
- **MD5 密码认证被弃用**: 建议使用 SCRAM-SHA-256
- **VACUUM 和 ANALYZE 行为变更**: 优化了维护操作的行为
- **移除无效的规则权限支持**: 清理了过时的规则权限机制

## 总体趋势

### 功能演进
- **并行处理能力持续增强**: 从基础的并行查询到更复杂的并行操作
- **JSON 支持越来越完善**: 从基础 JSON 到完整的 SQL/JSON 标准支持，越来越 NoSQL
- **分区功能不断改进**: 从基本分区到高级分区裁剪和管理
- **逻辑复制功能越来越强大**: 从基础复制到高级复制特性

### 破坏性变更趋势
- **移除过时功能**: 保持系统简洁，移除不再需要的功能
- **增强安全性和权限控制**: 不断提高安全性标准
- **改进默认行为和性能**: 优化默认设置以提升性能
- **标准化更多的 SQL 功能**: 更好地符合 SQL 标准

### 版本选择建议
- **生产环境**: 建议使用次新的主版本，譬如 2025 年的现在可以选择 16 或者 17.
- **测试环境**: 可以尝试最新版本以测试新功能
- **升级策略**: 建议每次跳过不超过2个版本进行升级

每个版本都致力于提升性能、增强功能和改善用户体验，同时尽量减少对现有应用的破坏性影响。PostgreSQL 团队承诺每个主版本都有 5 年的支持周期。
